{"name":"Repetition Penalty Logits Processor","type":"COMPOSITE_OPERATION","inputs":[{"name":"Logits","primitive_name":"Input"},{"name":"Selected Indices","primitive_name":"Input (1)"}],"outputs":[{"name":"Next Token Scores","primitive_name":"Output","flow_state":"UNBOUND"}],"operations":[{"name":"reduce_one_dimension","primitive_name":"reduce_one_dimension","type":"PRIMITIVE_OPERATION","aliases":["decrease_one_dimension","get_sub_array","get_subarray","get_sub_elements","get_subelements"],"position":{"x":396,"y":206},"inputs":[{"name":"input","primitive_name":"input"},{"name":"dimension_index","data":0,"shape":[],"type":"INTEGER","primitive_name":"dimension_index","flow_state":"BOOT_SOURCE"},{"name":"selected_index","data":0,"shape":[],"type":"INTEGER","primitive_name":"selected_index","flow_state":"BOOT_SOURCE"}],"outputs":[{"name":"output","primitive_name":"output","flow_state":"UNBOUND"}]},{"name":"get_sub_arrays_1","primitive_name":"get_sub_arrays","type":"PRIMITIVE_OPERATION","aliases":["batch_get_sub_arrays","batch_get_subarrays","get_sub_arrays_by_batch","get_subarrays_by_batch","get_elements","get_sub_elements","get_subelements"],"position":{"x":846,"y":48},"inputs":[{"name":"input","primitive_name":"input"},{"name":"dimension_index","data":1,"shape":[],"type":"INTEGER","primitive_name":"dimension_index","flow_state":"BOOT_SOURCE"},{"name":"selected_indices","primitive_name":"selected_indices"}],"outputs":[{"name":"output","primitive_name":"output","flow_state":"UNBOUND"}]},{"name":"swap_dimensions","primitive_name":"swap_dimensions","type":"PRIMITIVE_OPERATION","aliases":["swap_axis","swap_axes","change_dimensions","exchange_dimensions","transpose","permute"],"position":{"x":1217,"y":48},"inputs":[{"name":"array","primitive_name":"array"},{"name":"dimension_index_1","data":0,"shape":[],"type":"INTEGER","primitive_name":"dimension_index_1","flow_state":"BOOT_SOURCE"},{"name":"dimension_index_2","data":1,"shape":[],"type":"INTEGER","primitive_name":"dimension_index_2","flow_state":"BOOT_SOURCE"}],"outputs":[{"name":"swapped_array","primitive_name":"swapped_array","flow_state":"UNBOUND"}]},{"name":"Repetition Penalty Calc","type":"COMPOSITE_OPERATION","position":{"x":1667,"y":48},"inputs":[{"name":"Logits","primitive_name":"Input"}],"outputs":[{"name":"Output","primitive_name":"Output","flow_state":"UNBOUND"}],"operations":[{"name":"get_shape","primitive_name":"get_shape","type":"PRIMITIVE_OPERATION","aliases":["shape","size","get_size"],"position":{"x":307,"y":278},"inputs":[{"name":"input","primitive_name":"input"}],"outputs":[{"name":"shape","primitive_name":"shape","flow_state":"UNBOUND"}]},{"name":"broadcast_to_shape","primitive_name":"broadcast_to_shape","type":"PRIMITIVE_OPERATION","aliases":["tile_to_shape","expand_to_shape","extend_to_shape"],"position":{"x":818,"y":556},"inputs":[{"name":"target","data":0.0,"shape":[],"type":"DECIMAL","primitive_name":"target","flow_state":"BOOT_SOURCE"},{"name":"shape","primitive_name":"shape"}],"outputs":[{"name":"zeros","primitive_name":"result","flow_state":"UNBOUND"}]},{"name":"less_than_1","primitive_name":"less_than","type":"PRIMITIVE_OPERATION","aliases":["lt","less","smaller","smaller_than"],"position":{"x":1689,"y":46},"inputs":[{"name":"left_operand","primitive_name":"left_operand"},{"name":"right_operand","primitive_name":"right_operand"}],"outputs":[{"name":"is_less_than","primitive_name":"is_less_than","flow_state":"UNBOUND"}]},{"name":"broadcast_to_shape_1","primitive_name":"broadcast_to_shape","type":"PRIMITIVE_OPERATION","aliases":["tile_to_shape","expand_to_shape","extend_to_shape"],"position":{"x":661,"y":240},"inputs":[{"name":"penalty_","shape":[],"type":"DECIMAL","primitive_name":"target","global_constant":"logits_process.repeat_penalty"},{"name":"shape","primitive_name":"shape"}],"outputs":[{"name":"penalty","primitive_name":"result","flow_state":"UNBOUND"}]},{"name":"element_wise_multiply","primitive_name":"element_wise_multiply","type":"PRIMITIVE_OPERATION","aliases":["times"],"position":{"x":1035,"y":155},"inputs":[{"name":"left_array","primitive_name":"left_array"},{"name":"right_array","primitive_name":"right_array"}],"outputs":[{"name":"score * penalty","primitive_name":"multiplied_array","flow_state":"UNBOUND"}]},{"name":"divide","primitive_name":"divide","type":"PRIMITIVE_OPERATION","aliases":["div"],"position":{"x":1364,"y":432},"inputs":[{"name":"left_operand","primitive_name":"left_operand"},{"name":"right_operand","primitive_name":"right_operand"}],"outputs":[{"name":"score / penalty","primitive_name":"divided_result","flow_state":"UNBOUND"}]},{"name":"conditional_filter","primitive_name":"conditional_filter","type":"PRIMITIVE_OPERATION","aliases":["conditional_merge","replace","where"],"position":{"x":2137,"y":304},"inputs":[{"name":"condition","primitive_name":"condition"},{"name":"data_if_true","primitive_name":"data_if_true"},{"name":"data_if_false","primitive_name":"data_if_false"}],"outputs":[{"name":"output_data","primitive_name":"output_data","flow_state":"UNBOUND"}]}],"links":[{"source":{"operation":"this","data":"Logits"},"sink":{"operation":"get_shape","data":"input"},"control_points":[]},{"source":{"operation":"get_shape","data":"shape"},"sink":{"operation":"broadcast_to_shape","data":"shape"},"control_points":[]},{"source":{"operation":"get_shape","data":"shape"},"sink":{"operation":"broadcast_to_shape_1","data":"shape"},"control_points":[]},{"source":{"operation":"this","data":"Logits"},"sink":{"operation":"less_than_1","data":"left_operand"},"control_points":[]},{"source":{"operation":"broadcast_to_shape","data":"zeros"},"sink":{"operation":"less_than_1","data":"right_operand"},"control_points":[{"x":1436,"y":139}]},{"source":{"operation":"less_than_1","data":"is_less_than"},"sink":{"operation":"conditional_filter","data":"condition"},"control_points":[]},{"source":{"operation":"this","data":"Logits"},"sink":{"operation":"element_wise_multiply","data":"left_array"},"control_points":[{"x":220,"y":210}]},{"source":{"operation":"broadcast_to_shape_1","data":"penalty"},"sink":{"operation":"element_wise_multiply","data":"right_array"},"control_points":[]},{"source":{"operation":"element_wise_multiply","data":"score * penalty"},"sink":{"operation":"conditional_filter","data":"data_if_true"},"control_points":[{"x":1813,"y":398}]},{"source":{"operation":"this","data":"Logits"},"sink":{"operation":"divide","data":"left_operand"},"control_points":[{"x":443,"y":488}]},{"source":{"operation":"broadcast_to_shape_1","data":"penalty"},"sink":{"operation":"divide","data":"right_operand"},"control_points":[]},{"source":{"operation":"divide","data":"score / penalty"},"sink":{"operation":"conditional_filter","data":"data_if_false"},"control_points":[{"x":1811,"y":436}]},{"source":{"operation":"conditional_filter","data":"output_data"},"sink":{"operation":"this","data":"Output"},"control_points":[]}]},{"name":"scatter","primitive_name":"scatter","type":"PRIMITIVE_OPERATION","aliases":["copy_cells_into_selected_indices"],"position":{"x":2306,"y":562},"inputs":[{"name":"source_array","primitive_name":"source_array"},{"name":"receiver_array","primitive_name":"receiver_array"},{"name":"dimension_index","data":1,"shape":[],"type":"INTEGER","primitive_name":"dimension_index","flow_state":"BOOT_SOURCE"},{"name":"selected_indices","primitive_name":"selected_indices"}],"outputs":[{"name":"output","primitive_name":"output","flow_state":"UNBOUND"}]}],"links":[{"source":{"operation":"this","data":"Selected Indices"},"sink":{"operation":"scatter","data":"selected_indices"},"control_points":[{"x":538,"y":732}]},{"source":{"operation":"this","data":"Logits"},"sink":{"operation":"get_sub_arrays_1","data":"input"},"control_points":[]},{"source":{"operation":"this","data":"Selected Indices"},"sink":{"operation":"reduce_one_dimension","data":"input"},"control_points":[]},{"source":{"operation":"reduce_one_dimension","data":"output"},"sink":{"operation":"get_sub_arrays_1","data":"selected_indices"},"control_points":[]},{"source":{"operation":"this","data":"Logits"},"sink":{"operation":"scatter","data":"receiver_array"},"control_points":[{"x":551,"y":656}]},{"source":{"operation":"get_sub_arrays_1","data":"output"},"sink":{"operation":"swap_dimensions","data":"array"},"control_points":[]},{"source":{"operation":"swap_dimensions","data":"swapped_array"},"sink":{"operation":"Repetition Penalty Calc","data":"Logits"},"control_points":[]},{"source":{"operation":"Repetition Penalty Calc","data":"Output"},"sink":{"operation":"scatter","data":"source_array"},"control_points":[]},{"source":{"operation":"scatter","data":"output"},"sink":{"operation":"this","data":"Next Token Scores"},"control_points":[]}],"global_constants":[{"name":"logits_process.repeat_penalty","data":2.5,"shape":[],"type":"DECIMAL","primitive_name":"logits_process.repeat_penalty"}]}